<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev Monkey ‚Äî —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #14141f;
            --bg-card: #1c1c2c;
            --accent: #f39c12;
            --accent-hover: #ffb347;
            --accent-soft: rgba(243, 156, 18, 0.15);
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --border-color: #2a2a3a;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f1c40f;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(243, 156, 18, 0.03) 0%, transparent 30%),
                radial-gradient(circle at 90% 80%, rgba(243, 156, 18, 0.03) 0%, transparent 30%);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, #1a1a2e 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--accent);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent) 0%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(243, 156, 18, 0.3);
        }
        .logo span {
            background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        button {
            background: transparent;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 0.6rem 1.4rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.95rem;
            letter-spacing: 0.3px;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            background: var(--accent);
            color: var(--bg-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        button.primary {
            background: var(--accent);
            color: var(--bg-primary);
        }

        button.primary:hover {
            background: var(--accent-hover);
            border-color: var(--accent-hover);
        }

        button.small {
            padding: 0.4rem 1rem;
            font-size: 0.85rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--bg-primary);
            padding: 0.4rem 1.2rem 0.4rem 0.4rem;
            border-radius: 40px;
            border: 2px solid var(--accent);
            box-shadow: 0 0 15px rgba(243, 156, 18, 0.2);
        }

        .avatar-mini {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #ffd700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.3rem;
            color: var(--bg-primary);
            border: 2px solid white;
        }

        .avatar-mini img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Main layout */
        .main-layout {
            display: flex;
            padding: 2rem;
            gap: 2rem;
            flex-wrap: wrap;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .profiles-list {
            background: var(--bg-card);
            border-radius: 30px;
            padding: 1.8rem;
            width: 320px;
            flex-shrink: 0;
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .profiles-list h3 {
            margin-bottom: 1.5rem;
            color: var(--accent);
            font-weight: 600;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 1rem;
            border-radius: 20px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid transparent;
        }

        .profile-item:hover {
            background: var(--accent-soft);
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .profile-item.active {
            background: linear-gradient(90deg, var(--accent-soft) 0%, transparent 100%);
            border-left: 4px solid var(--accent);
        }

        .item-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #ffd700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            border: 2px solid white;
            overflow: hidden;
        }

        .item-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-info h4 {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .item-info p {
            font-size: 0.8rem;
            opacity: 0.6;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .profile-view {
            background: var(--bg-card);
            border-radius: 40px;
            padding: 2.5rem;
            flex: 1;
            min-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .profile-header {
            display: flex;
            gap: 2.5rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 2.5rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        .profile-avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), #ffd700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            border: 4px solid white;
            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.5);
            overflow: hidden;
            position: relative;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            font-size: 0.8rem;
            text-align: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .profile-avatar:hover .avatar-overlay {
            opacity: 1;
        }

        .profile-title h2 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .profile-bio {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 500px;
            line-height: 1.5;
        }

        /* –°—Å—ã–ª–∫–∏ */
        .links-section {
            margin: 2rem 0;
        }

        .links-section h3 {
            color: var(--accent);
            margin-bottom: 1.2rem;
            font-size: 1.3rem;
        }

        .link-card {
            background: var(--bg-secondary);
            padding: 1rem 1.5rem;
            border-radius: 50px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .link-card:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .link-card a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
        }

        .link-card a:hover {
            text-decoration: underline;
        }

        /* –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ */
        .copy-link {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            margin: 1.5rem 0;
            background: var(--bg-secondary);
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            width: fit-content;
            border: 1px solid var(--border-color);
        }

        .copy-link input {
            background: transparent;
            border: none;
            color: var(--text-primary);
            padding: 0.5rem;
            width: 280px;
            font-size: 0.9rem;
        }

        .copy-link input:focus {
            outline: none;
        }

        /* –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .edit-field {
            margin-bottom: 1rem;
        }

        .edit-field input, 
        .edit-field textarea,
        .edit-field select {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.8rem 1.2rem;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .edit-field input:focus,
        .edit-field textarea:focus,
        .edit-field select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .link-edit-row {
            display: flex;
            gap: 10px;
            align-items: center;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 20px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .link-edit-row input {
            flex: 1;
            min-width: 200px;
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 16px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--bg-card);
            padding: 2.5rem;
            border-radius: 40px;
            width: 400px;
            max-width: 90%;
            border: 2px solid var(--accent);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
        }

        .modal-content h3 {
            margin-bottom: 1.5rem;
            color: var(--accent);
            font-size: 1.8rem;
        }

        .modal-content input {
            width: 100%;
            padding: 1rem;
            margin: 10px 0;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: white;
            border-radius: 16px;
            font-size: 1rem;
        }

        .modal-content input:focus {
            border-color: var(--accent);
            outline: none;
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-secondary);
        }

        .user-select-btn {
            display: block;
            width: 100%;
            margin: 8px 0;
            text-align: left;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: white;
            padding: 1rem;
            border-radius: 16px;
            font-size: 1rem;
        }

        .user-select-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg-primary);
        }

        .error-msg {
            color: var(--danger);
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .success-msg {
            color: var(--success);
            margin: 10px 0;
        }

        .hidden {
            display: none !important;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .profile-view {
            animation: fadeIn 0.3s ease;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ */
        .avatar-upload {
            margin: 1rem 0;
        }

        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 3px solid var(--accent);
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">Dev <span>Monkey</span></div>
        <div id="authSection" class="auth-buttons">
            <button id="loginBtn">–í–æ–π—Ç–∏</button>
            <button id="registerBtn" class="primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
        </div>
    </header>

    <div class="main-layout">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö) -->
        <div class="profiles-list">
            <h3>üêí –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–±–µ–∑—å—è–Ω–∫–∏ <span id="usersCount" style="color: var(--text-secondary); font-size: 0.9rem;"></span></h3>
            <div id="profilesContainer"></div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è -->
        <div class="profile-view" id="profileView">
            <div id="profileDisplay"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal" class="modal hidden">
        <div class="modal-content">
            <h3>üêµ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input type="text" id="regNickname" placeholder="–ù–∏–∫–Ω–µ–π–º" autocomplete="off">
            <div class="password-input">
                <input type="password" id="regPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                <span class="toggle-password" onclick="togglePassword('regPassword')">üëÅÔ∏è</span>
            </div>
            <div class="password-input">
                <input type="password" id="regConfirmPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <div class="avatar-upload">
                <div class="avatar-preview" id="avatarPreview">
                    <img src="https://via.placeholder.com/100/f39c12/ffffff?text=üêµ" alt="preview">
                </div>
                <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                <button class="small" onclick="document.getElementById('avatarUpload').click()">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            </div>
            <div id="regError" class="error-msg"></div>
            <button id="registerConfirm" class="primary" style="width: 100%; margin: 10px 0;">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button id="closeRegister" style="width: 100%;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <h3>üîê –í—Ö–æ–¥</h3>
            <select id="loginUserSelect" style="width: 100%; padding: 1rem; margin: 10px 0; background: var(--bg-secondary); border: 2px solid var(--border-color); color: white; border-radius: 16px;">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>
            </select>
            <div class="password-input">
                <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                <span class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</span>
            </div>
            <div id="loginError" class="error-msg"></div>
            <button id="loginConfirm" class="primary" style="width: 100%; margin: 10px 0;">–í–æ–π—Ç–∏</button>
            <button id="closeLogin" style="width: 100%;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        (function() {
            // ---- –¥–∞–Ω–Ω—ã–µ –∏ localstorage ----
            const STORAGE_KEY = 'devmonkey_profiles_v2';
            const SESSION_KEY = 'devmonkey_current_user_v2';

            // –ë–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            let users = [];
            let currentUser = null;

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            function loadData() {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    users = JSON.parse(stored);
                } else {
                    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–∞—Ä–æ–ª—è–º–∏
                    users = [
                        { 
                            nickname: 'Alice', 
                            password: '123', 
                            bio: '–§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ üêà', 
                            avatar: 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23f39c12\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'white\'%3Eüë©%3C/text%3E%3C/svg%3E',
                            links: [
                                { title: 'GitHub', url: 'https://github.com/alice' },
                                { title: 'Telegram', url: 'https://t.me/alice_dev' }
                            ]
                        },
                        { 
                            nickname: 'Bob', 
                            password: '123', 
                            bio: '–ë—ç–∫–µ–Ω–¥-–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä üêª', 
                            avatar: 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23f39c12\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'white\'%3Eüë®%3C/text%3E%3C/svg%3E',
                            links: [
                                { title: 'LinkedIn', url: 'https://linkedin.com/in/bob' }
                            ]
                        },
                        { 
                            nickname: 'Charlie', 
                            password: '123', 
                            bio: 'Fullstack —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ üêí', 
                            avatar: 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23f39c12\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'white\'%3Eüêµ%3C/text%3E%3C/svg%3E',
                            links: []
                        }
                    ];
                    saveUsers();
                }

                // –¢–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è
                const session = localStorage.getItem(SESSION_KEY);
                if (session) {
                    const found = users.find(u => u.nickname === session);
                    if (found) {
                        currentUser = { ...found };
                        // –ù–µ —Ö—Ä–∞–Ω–∏–º –ø–∞—Ä–æ–ª—å –≤ currentUser –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                        delete currentUser.password;
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                updateUsersCount();
            }

            function saveUsers() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
                // –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—Å–µ—Ö
                renderProfilesList(currentUser?.nickname || null);
                updateUsersCount();
            }

            function updateUsersCount() {
                const countEl = document.getElementById('usersCount');
                if (countEl) {
                    countEl.textContent = `(${users.length})`;
                }
            }

            function saveSession(nickname) {
                if (nickname) {
                    localStorage.setItem(SESSION_KEY, nickname);
                } else {
                    localStorage.removeItem(SESSION_KEY);
                }
            }

            // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function getUserByNick(nick) {
                return users.find(u => u.nickname === nick);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function updateUserInList(updatedUser) {
                const index = users.findIndex(u => u.nickname === updatedUser.nickname);
                if (index !== -1) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞—Ä–æ–ª—å –∏–∑ —Å—Ç–∞—Ä–æ–π –∑–∞–ø–∏—Å–∏
                    const oldPassword = users[index].password;
                    users[index] = { ...updatedUser, password: oldPassword };
                    saveUsers();
                    
                    // –ï—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
                    if (currentUser && currentUser.nickname === updatedUser.nickname) {
                        currentUser = { ...updatedUser };
                        delete currentUser.password;
                    }
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è –≤—Å–µ—Ö
                    renderProfilesList(currentUser?.nickname || null);
                    
                    // –ï—Å–ª–∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º—ã–π –ø—Ä–æ—Ñ–∏–ª—å - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π, –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ–º –µ–≥–æ
                    const activeProfile = document.querySelector('.profile-item.active');
                    if (activeProfile && activeProfile.dataset.nick === updatedUser.nickname) {
                        renderProfileView(updatedUser.nickname);
                    }
                }
            }

            // ---- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π (—Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç –≤—Å–µ –Ω–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏) ----
            function renderProfilesList(activeNick) {
                const container = document.getElementById('profilesContainer');
                if (!container) return;
                
                container.innerHTML = '';
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
                const sortedUsers = [...users].sort((a, b) => a.nickname.localeCompare(b.nickname));
                
                sortedUsers.forEach(user => {
                    const item = document.createElement('div');
                    item.className = `profile-item ${activeNick === user.nickname ? 'active' : ''}`;
                    item.dataset.nick = user.nickname;
                    
                    // –ê–≤–∞—Ç–∞—Ä–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
                    const avatarHtml = user.avatar && user.avatar.startsWith('data:') 
                        ? `<img src="${user.avatar}" alt="${user.nickname}">`
                        : (user.avatar || 'üêµ');
                    
                    item.innerHTML = `
                        <div class="item-avatar">${avatarHtml}</div>
                        <div class="item-info">
                            <h4>${user.nickname}</h4>
                            <p>${user.links ? user.links.length : 0} —Å—Å—ã–ª–æ–∫</p>
                        </div>
                    `;
                    
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        renderProfileView(user.nickname);
                        renderProfilesList(user.nickname);
                        // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
                        window.location.hash = `profile-${user.nickname}`;
                    });
                    
                    container.appendChild(item);
                });
            }

            // ---- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64 ----
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }

            // ---- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è ----
            function renderProfileView(nickname) {
                const user = getUserByNick(nickname);
                if (!user) return;
                
                const container = document.getElementById('profileDisplay');
                const isOwner = currentUser && currentUser.nickname === nickname;

                // –ê–≤–∞—Ç–∞—Ä–∫–∞
                const avatarHtml = user.avatar && user.avatar.startsWith('data:')
                    ? `<img src="${user.avatar}" alt="${user.nickname}">`
                    : (user.avatar || 'üêµ');

                let html = `
                    <div class="profile-header">
                        <div class="profile-avatar">
                            ${avatarHtml}
                            ${isOwner ? '<div class="avatar-overlay" onclick="document.getElementById(\'editAvatarFile\').click()">–ò–∑–º–µ–Ω–∏—Ç—å</div>' : ''}
                        </div>
                        <div class="profile-title">
                            <h2>${user.nickname}</h2>
                            <div class="profile-bio">${user.bio || '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫-–æ–±–µ–∑—å—è–Ω'}</div>
                        </div>
                    </div>
                `;

                // –°—Å—ã–ª–∫–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                const profileUrl = `${window.location.origin}${window.location.pathname}#profile-${user.nickname}`;
                html += `
                    <div class="copy-link">
                        <input type="text" value="${profileUrl}" id="profileLinkInput" readonly>
                        <button class="small" id="copyLinkBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                `;

                // –°—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                html += `<div class="links-section"><h3>üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>`;
                if (user.links && user.links.length > 0) {
                    user.links.forEach(link => {
                        html += `
                            <div class="link-card">
                                <span>üîó</span>
                                <a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.title}</a>
                            </div>
                        `;
                    });
                } else {
                    html += `<p style="color: var(--text-secondary);">–ü–æ–∫–∞ –Ω–µ—Ç —Å—Å—ã–ª–æ–∫</p>`;
                }
                html += `</div>`;

                // –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
                if (isOwner) {
                    html += `
                        <div class="action-buttons">
                            <button id="startEditProfileBtn" class="primary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                        </div>
                    `;
                }

                container.innerHTML = html;

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.getElementById('copyLinkBtn')?.addEventListener('click', () => {
                    const input = document.getElementById('profileLinkInput');
                    input.select();
                    navigator.clipboard.writeText(input.value).then(() => {
                        const btn = document.getElementById('copyLinkBtn');
                        const originalText = btn.textContent;
                        btn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                        setTimeout(() => btn.textContent = originalText, 2000);
                    });
                });

                if (isOwner) {
                    document.getElementById('startEditProfileBtn')?.addEventListener('click', () => {
                        renderEditProfile(nickname);
                    });
                }
            }

            // ---- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ----
            function renderEditProfile(nickname) {
                const user = getUserByNick(nickname);
                if (!user || !currentUser || currentUser.nickname !== nickname) return;

                const container = document.getElementById('profileDisplay');
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª—è –¥–ª—è —Å—Å—ã–ª–æ–∫
                let linksHtml = '';
                user.links.forEach((link, index) => {
                    linksHtml += `
                        <div class="link-edit-row" data-index="${index}">
                            <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value="${link.title}" class="link-title-input">
                            <input type="url" placeholder="https://..." value="${link.url}" class="link-url-input">
                            <button class="small remove-link-btn" style="background: var(--danger); border-color: var(--danger);">‚ùå</button>
                        </div>
                    `;
                });

                const editHtml = `
                    <div class="profile-header">
                        <div class="profile-avatar" id="editAvatarPreview">
                            ${user.avatar && user.avatar.startsWith('data:') 
                                ? `<img src="${user.avatar}" alt="avatar" style="width:100%; height:100%; object-fit:cover;">`
                                : (user.avatar || 'üêµ')}
                        </div>
                        <div class="profile-title">
                            <div class="edit-field">
                                <input type="text" id="editNickname" value="${user.nickname}" placeholder="–ù–∏–∫–Ω–µ–π–º" disabled style="background: var(--bg-secondary);">
                            </div>
                            <div class="edit-field">
                                <textarea id="editBio" rows="3" placeholder="–û —Å–µ–±–µ...">${user.bio || ''}</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <input type="file" id="editAvatarFile" accept="image/*" style="display: none;">
                    
                    <div class="links-section">
                        <h3>üîó –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏</h3>
                        <div id="linksEditContainer">${linksHtml}</div>
                        <button id="addLinkBtn" class="small" style="margin-top: 10px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
                    </div>
                    
                    <div class="action-buttons" style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button id="saveProfileBtn" class="primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                        <button id="cancelEditBtn">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                `;
                
                container.innerHTML = editHtml;

                // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
                document.getElementById('editAvatarFile')?.addEventListener('change', async (e) => {
                    if (e.target.files && e.target.files[0]) {
                        const base64 = await fileToBase64(e.target.files[0]);
                        const preview = document.getElementById('editAvatarPreview');
                        if (preview) {
                            preview.innerHTML = `<img src="${base64}" alt="avatar" style="width:100%; height:100%; object-fit:cover;">`;
                        }
                        // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ data-–∞—Ç—Ä–∏–±—É—Ç
                        preview.dataset.newAvatar = base64;
                    }
                });

                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
                document.getElementById('addLinkBtn')?.addEventListener('click', () => {
                    const container = document.getElementById('linksEditContainer');
                    const newRow = document.createElement('div');
                    newRow.className = 'link-edit-row';
                    newRow.innerHTML = `
                        <input type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="link-title-input" value="–ù–æ–≤–∞—è —Å—Å—ã–ª–∫–∞">
                        <input type="url" placeholder="https://..." class="link-url-input" value="https://">
                        <button class="small remove-link-btn" style="background: var(--danger); border-color: var(--danger);">‚ùå</button>
                    `;
                    container.appendChild(newRow);
                    attachRemoveListeners();
                });

                function attachRemoveListeners() {
                    document.querySelectorAll('.remove-link-btn').forEach(btn => {
                        btn.removeEventListener('click', removeHandler);
                        btn.addEventListener('click', removeHandler);
                    });
                }

                function removeHandler(e) {
                    e.preventDefault();
                    e.target.closest('.link-edit-row')?.remove();
                }
                
                attachRemoveListeners();

                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                document.getElementById('saveProfileBtn')?.addEventListener('click', async () => {
                    const newBio = document.getElementById('editBio')?.value || '';
                    
                    // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π –∞–≤–∞—Ç–∞—Ä –µ—Å–ª–∏ –µ—Å—Ç—å
                    const preview = document.getElementById('editAvatarPreview');
                    let newAvatar = user.avatar;
                    if (preview && preview.dataset.newAvatar) {
                        newAvatar = preview.dataset.newAvatar;
                    }

                    // –°–æ–±–∏—Ä–∞–µ–º —Å—Å—ã–ª–∫–∏
                    const linkRows = document.querySelectorAll('.link-edit-row');
                    const newLinks = [];
                    linkRows.forEach(row => {
                        const title = row.querySelector('.link-title-input')?.value.trim();
                        const url = row.querySelector('.link-url-input')?.value.trim();
                        if (title && url) {
                            newLinks.push({ title, url });
                        }
                    });

                    const updatedUser = {
                        ...user,
                        bio: newBio,
                        avatar: newAvatar,
                        links: newLinks
                    };

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ
                    updateUserInList(updatedUser);
                    
                    // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    renderProfileView(nickname);
                });

                document.getElementById('cancelEditBtn')?.addEventListener('click', () => {
                    renderProfileView(nickname);
                });
            }

            // ---- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–ø–∫–∏ ----
            function renderHeader() {
                const authSection = document.getElementById('authSection');
                if (currentUser) {
                    const avatarHtml = currentUser.avatar && currentUser.avatar.startsWith('data:')
                        ? `<img src="${currentUser.avatar}" alt="${currentUser.nickname}">`
                        : (currentUser.avatar || 'üêµ');
                    
                    authSection.innerHTML = `
                        <div class="user-info">
                            <div class="avatar-mini">${avatarHtml}</div>
                            <span class="username-mini">${currentUser.nickname}</span>
                        </div>
                        <button id="logoutBtn">–í—ã–π—Ç–∏</button>
                    `;
                    
                    document.getElementById('logoutBtn')?.addEventListener('click', () => {
                        currentUser = null;
                        saveSession(null);
                        renderHeader();
                        if (users.length > 0) {
                            renderProfileView(users[0].nickname);
                            renderProfilesList(users[0].nickname);
                        }
                    });
                } else {
                    authSection.innerHTML = `
                        <button id="loginBtn">–í–æ–π—Ç–∏</button>
                        <button id="registerBtn" class="primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    `;
                    
                    document.getElementById('loginBtn')?.addEventListener('click', openLoginModal);
                    document.getElementById('registerBtn')?.addEventListener('click', openRegisterModal);
                }
            }

            // ---- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ----
            function openRegisterModal() {
                const modal = document.getElementById('registerModal');
                const nicknameInput = document.getElementById('regNickname');
                const passwordInput = document.getElementById('regPassword');
                const confirmInput = document.getElementById('regConfirmPassword');
                const errorDiv = document.getElementById('regError');
                const avatarInput = document.getElementById('avatarUpload');
                let selectedAvatar = null;
                
                nicknameInput.value = '';
                passwordInput.value = '';
                confirmInput.value = '';
                errorDiv.textContent = '';
                modal.classList.remove('hidden');

                // –ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∞
                document.getElementById('avatarPreview').innerHTML = '<img src="https://via.placeholder.com/100/f39c12/ffffff?text=üêµ" alt="preview">';
                
                avatarInput.onchange = async (e) => {
                    if (e.target.files && e.target.files[0]) {
                        selectedAvatar = await fileToBase64(e.target.files[0]);
                        document.getElementById('avatarPreview').innerHTML = `<img src="${selectedAvatar}" alt="preview" style="width:100%; height:100%; object-fit:cover;">`;
                    }
                };

                document.getElementById('registerConfirm').onclick = () => {
                    const nickname = nicknameInput.value.trim();
                    const password = passwordInput.value;
                    const confirm = confirmInput.value;

                    if (!nickname || !password) {
                        errorDiv.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                        return;
                    }

                    if (password !== confirm) {
                        errorDiv.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                        return;
                    }

                    if (password.length < 3) {
                        errorDiv.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                        return;
                    }

                    if (users.some(u => u.nickname.toLowerCase() === nickname.toLowerCase())) {
                        errorDiv.textContent = '–≠—Ç–æ—Ç –Ω–∏–∫–Ω–µ–π–º —É–∂–µ –∑–∞–Ω—è—Ç';
                        return;
                    }

                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const newUser = {
                        nickname: nickname,
                        password: password,
                        bio: '–ù–æ–≤–∞—è –æ–±–µ–∑—å—è–Ω–∫–∞',
                        avatar: selectedAvatar || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23f39c12\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'white\'%3Eüêµ%3C/text%3E%3C/svg%3E',
                        links: []
                    };

                    users.push(newUser);
                    saveUsers();
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥
                    currentUser = { ...newUser };
                    delete currentUser.password;
                    saveSession(nickname);
                    
                    modal.classList.add('hidden');
                    renderHeader();
                    renderProfilesList(nickname);
                    renderProfileView(nickname);
                    window.location.hash = `profile-${nickname}`;
                };

                document.getElementById('closeRegister').onclick = () => {
                    modal.classList.add('hidden');
                };
            }

            // ---- –í—Ö–æ–¥ —Å –ø–∞—Ä–æ–ª–µ–º ----
            function openLoginModal() {
                const modal = document.getElementById('loginModal');
                const select = document.getElementById('loginUserSelect');
                const passwordInput = document.getElementById('loginPassword');
                const errorDiv = document.getElementById('loginError');
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.nickname;
                    option.textContent = `${user.avatar ? 'üêµ' : 'üë§'} ${user.nickname}`;
                    select.appendChild(option);
                });
                
                passwordInput.value = '';
                errorDiv.textContent = '';
                modal.classList.remove('hidden');

                document.getElementById('loginConfirm').onclick = () => {
                    const nickname = select.value;
                    const password = passwordInput.value;

                    if (!nickname) {
                        errorDiv.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                        return;
                    }

                    const user = getUserByNick(nickname);
                    if (!user) {
                        errorDiv.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                        return;
                    }

                    if (user.password !== password) {
                        errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                        return;
                    }

                    // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
                    currentUser = { ...user };
                    delete currentUser.password;
                    saveSession(nickname);
                    
                    modal.classList.add('hidden');
                    renderHeader();
                    renderProfilesList(nickname);
                    renderProfileView(nickname);
                    window.location.hash = `profile-${nickname}`;
                };

                document.getElementById('closeLogin').onclick = () => {
                    modal.classList.add('hidden');
                };
            }

            // ---- –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å ----
            window.togglePassword = function(fieldId) {
                const field = document.getElementById(fieldId);
                if (field.type === 'password') {
                    field.type = 'text';
                } else {
                    field.type = 'password';
                }
            };

            // ---- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ----
            function init() {
                loadData();
                renderHeader();

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º hash
                let initialNick = null;
                const hashMatch = window.location.hash.match(/^#profile-(.+)$/);
                if (hashMatch) {
                    const hashNick = decodeURIComponent(hashMatch[1]);
                    if (getUserByNick(hashNick)) {
                        initialNick = hashNick;
                    }
                }

                if (!initialNick) {
                    initialNick = currentUser ? currentUser.nickname : (users[0]?.nickname || null);
                }

                if (initialNick) {
                    renderProfileView(initialNick);
                    renderProfilesList(initialNick);
                }

                // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è hash
                window.addEventListener('hashchange', () => {
                    const match = window.location.hash.match(/^#profile-(.+)$/);
                    if (match) {
                        const nick = decodeURIComponent(match[1]);
                        if (getUserByNick(nick)) {
                            renderProfileView(nick);
                            renderProfilesList(nick);
                        }
                    }
                });

                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏)
                window.addEventListener('storage', (e) => {
                    if (e.key === STORAGE_KEY) {
                        // –î–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ
                        loadData();
                        renderHeader();
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
                        const activeItem = document.querySelector('.profile-item.active');
                        const activeNick = activeItem ? activeItem.dataset.nick : (users[0]?.nickname || null);
                        
                        if (activeNick) {
                            renderProfileView(activeNick);
                            renderProfilesList(activeNick);
                        }
                    }
                });
            }

            // –ó–∞–ø—É—Å–∫
            init();
        })();
    </script>
</body>
</html>
